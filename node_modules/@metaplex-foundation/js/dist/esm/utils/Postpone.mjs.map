{"version":3,"file":"Postpone.mjs","sources":["../../../src/utils/Postpone.ts"],"sourcesContent":["import { chunk } from '../utils/common';\n\ntype ArrayElement<ArrayType> = ArrayType extends readonly (infer ElementType)[]\n  ? ElementType\n  : never;\ntype AsArray<T> = ArrayElement<T>[];\ntype ArrayCallback<T, U> = (\n  item: ArrayElement<T>,\n  index: number,\n  array: AsArray<T>\n) => U;\n\nexport class Postpone<T> {\n  protected readonly value: () => Promise<T>;\n\n  constructor(value: () => Promise<T>) {\n    this.value = value;\n  }\n\n  static make<T>(value: () => Promise<T>) {\n    return new this(value);\n  }\n\n  asyncPipe<U>(callback: (value: Promise<T>) => Promise<U>): Postpone<U> {\n    return Postpone.make(async () => callback(this.value()));\n  }\n\n  pipe<U>(callback: (value: T) => U): Postpone<U> {\n    return this.asyncPipe(async (value) => callback(await value));\n  }\n\n  asyncTap(callback: (value: Promise<T>) => Promise<unknown>): Postpone<T> {\n    return this.asyncPipe(async (value) => {\n      callback(value);\n\n      return value;\n    });\n  }\n\n  tap(callback: (value: T) => unknown): Postpone<T> {\n    return this.asyncTap(async (value) => callback(await value));\n  }\n\n  log(): Postpone<T> {\n    return this.tap((v) => console.log(v));\n  }\n\n  map<U>(\n    this: Postpone<AsArray<T>>,\n    callback: ArrayCallback<T, U>\n  ): Postpone<U[]> {\n    return this.pipe((t) => t.map(callback));\n  }\n\n  flatMap<U>(\n    this: Postpone<AsArray<T>>,\n    callback: ArrayCallback<T, U[]>\n  ): Postpone<U[]> {\n    return this.pipe((t) => t.flatMap(callback));\n  }\n\n  chunk(this: Postpone<AsArray<T>>, size: number): Postpone<AsArray<T>[]> {\n    return this.pipe((t) => chunk(t, size));\n  }\n\n  filter<U extends T>(\n    this: Postpone<AsArray<T>>,\n    callback: ArrayCallback<T, unknown>\n  ): Postpone<AsArray<U>> {\n    return this.pipe((t) => t.filter(callback));\n  }\n\n  async run(): Promise<T> {\n    return this.value();\n  }\n}\n"],"names":["Postpone","constructor","value","make","asyncPipe","callback","pipe","asyncTap","tap","log","v","console","map","t","flatMap","chunk","size","filter","run"],"mappings":";;AAYO,MAAMA,QAAN,CAAkB;EAGvBC,WAAW,CAACC,KAAD,EAA0B;IACnC,IAAKA,CAAAA,KAAL,GAAaA,KAAb,CAAA;AACD,GAAA;;EAEU,OAAJC,IAAI,CAAID,KAAJ,EAA6B;AACtC,IAAA,OAAO,IAAI,IAAJ,CAASA,KAAT,CAAP,CAAA;AACD,GAAA;;EAEDE,SAAS,CAAIC,QAAJ,EAA8D;IACrE,OAAOL,QAAQ,CAACG,IAAT,CAAc,YAAYE,QAAQ,CAAC,IAAKH,CAAAA,KAAL,EAAD,CAAlC,CAAP,CAAA;AACD,GAAA;;EAEDI,IAAI,CAAID,QAAJ,EAA4C;IAC9C,OAAO,IAAA,CAAKD,SAAL,CAAe,MAAOF,KAAP,IAAiBG,QAAQ,CAAC,MAAMH,KAAP,CAAxC,CAAP,CAAA;AACD,GAAA;;EAEDK,QAAQ,CAACF,QAAD,EAAiE;AACvE,IAAA,OAAO,IAAKD,CAAAA,SAAL,CAAe,MAAOF,KAAP,IAAiB;MACrCG,QAAQ,CAACH,KAAD,CAAR,CAAA;AAEA,MAAA,OAAOA,KAAP,CAAA;AACD,KAJM,CAAP,CAAA;AAKD,GAAA;;EAEDM,GAAG,CAACH,QAAD,EAA+C;IAChD,OAAO,IAAA,CAAKE,QAAL,CAAc,MAAOL,KAAP,IAAiBG,QAAQ,CAAC,MAAMH,KAAP,CAAvC,CAAP,CAAA;AACD,GAAA;;AAEDO,EAAAA,GAAG,GAAgB;IACjB,OAAO,IAAA,CAAKD,GAAL,CAAUE,CAAD,IAAOC,OAAO,CAACF,GAAR,CAAYC,CAAZ,CAAhB,CAAP,CAAA;AACD,GAAA;;EAEDE,GAAG,CAEDP,QAFC,EAGc;IACf,OAAO,IAAA,CAAKC,IAAL,CAAWO,CAAD,IAAOA,CAAC,CAACD,GAAF,CAAMP,QAAN,CAAjB,CAAP,CAAA;AACD,GAAA;;EAEDS,OAAO,CAELT,QAFK,EAGU;IACf,OAAO,IAAA,CAAKC,IAAL,CAAWO,CAAD,IAAOA,CAAC,CAACC,OAAF,CAAUT,QAAV,CAAjB,CAAP,CAAA;AACD,GAAA;;EAEDU,KAAK,CAA6BC,IAA7B,EAAmE;IACtE,OAAO,IAAA,CAAKV,IAAL,CAAWO,CAAD,IAAOE,KAAK,CAACF,CAAD,EAAIG,IAAJ,CAAtB,CAAP,CAAA;AACD,GAAA;;EAEDC,MAAM,CAEJZ,QAFI,EAGkB;IACtB,OAAO,IAAA,CAAKC,IAAL,CAAWO,CAAD,IAAOA,CAAC,CAACI,MAAF,CAASZ,QAAT,CAAjB,CAAP,CAAA;AACD,GAAA;;AAEQ,EAAA,MAAHa,GAAG,GAAe;IACtB,OAAO,IAAA,CAAKhB,KAAL,EAAP,CAAA;AACD,GAAA;;AA9DsB;;;;"}