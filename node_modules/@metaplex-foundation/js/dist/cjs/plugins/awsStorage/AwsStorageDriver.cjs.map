{"version":3,"file":"AwsStorageDriver.cjs","sources":["../../../../src/plugins/awsStorage/AwsStorageDriver.ts"],"sourcesContent":["import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';\nimport { lamports, Amount } from '@/types';\nimport { MetaplexFile, StorageDriver } from '../storageModule';\n\nexport class AwsStorageDriver implements StorageDriver {\n  protected client: S3Client;\n  protected bucketName: string;\n\n  constructor(client: S3Client, bucketName: string) {\n    this.client = client;\n    this.bucketName = bucketName;\n  }\n\n  async getUploadPrice(_bytes: number): Promise<Amount> {\n    return lamports(0);\n  }\n\n  async upload(file: MetaplexFile): Promise<string> {\n    const command = new PutObjectCommand({\n      Bucket: this.bucketName,\n      Key: file.uniqueName,\n      Body: file.buffer,\n    });\n\n    try {\n      await this.client.send(command);\n\n      return await this.getUrl(file.uniqueName);\n    } catch (err) {\n      // TODO: Custom errors.\n      throw err;\n    }\n  }\n\n  async getUrl(key: string) {\n    const region = await this.client.config.region();\n    const encodedKey = encodeURIComponent(key);\n\n    return `https://s3.${region}.amazonaws.com/${this.bucketName}/${encodedKey}`;\n  }\n}\n"],"names":["AwsStorageDriver","constructor","client","bucketName","getUploadPrice","_bytes","lamports","upload","file","command","PutObjectCommand","Bucket","Key","uniqueName","Body","buffer","send","getUrl","err","key","region","config","encodedKey","encodeURIComponent"],"mappings":";;;;;;;AAIO,MAAMA,gBAAN,CAAgD;AAIrDC,EAAAA,WAAW,CAACC,MAAD,EAAmBC,UAAnB,EAAuC;IAChD,IAAKD,CAAAA,MAAL,GAAcA,MAAd,CAAA;IACA,IAAKC,CAAAA,UAAL,GAAkBA,UAAlB,CAAA;AACD,GAAA;;EAEmB,MAAdC,cAAc,CAACC,MAAD,EAAkC;IACpD,OAAOC,eAAQ,CAAC,CAAD,CAAf,CAAA;AACD,GAAA;;EAEW,MAANC,MAAM,CAACC,IAAD,EAAsC;AAChD,IAAA,MAAMC,OAAO,GAAG,IAAIC,yBAAJ,CAAqB;MACnCC,MAAM,EAAE,KAAKR,UADsB;MAEnCS,GAAG,EAAEJ,IAAI,CAACK,UAFyB;MAGnCC,IAAI,EAAEN,IAAI,CAACO,MAAAA;AAHwB,KAArB,CAAhB,CAAA;;IAMA,IAAI;AACF,MAAA,MAAM,KAAKb,MAAL,CAAYc,IAAZ,CAAiBP,OAAjB,CAAN,CAAA;AAEA,MAAA,OAAO,MAAM,IAAKQ,CAAAA,MAAL,CAAYT,IAAI,CAACK,UAAjB,CAAb,CAAA;KAHF,CAIE,OAAOK,GAAP,EAAY;AACZ;AACA,MAAA,MAAMA,GAAN,CAAA;AACD,KAAA;AACF,GAAA;;EAEW,MAAND,MAAM,CAACE,GAAD,EAAc;IACxB,MAAMC,MAAM,GAAG,MAAM,IAAA,CAAKlB,MAAL,CAAYmB,MAAZ,CAAmBD,MAAnB,EAArB,CAAA;AACA,IAAA,MAAME,UAAU,GAAGC,kBAAkB,CAACJ,GAAD,CAArC,CAAA;AAEA,IAAA,OAAQ,cAAaC,MAAO,CAAA,eAAA,EAAiB,KAAKjB,UAAW,CAAA,CAAA,EAAGmB,UAAW,CAA3E,CAAA,CAAA;AACD,GAAA;;AAnCoD;;;;"}