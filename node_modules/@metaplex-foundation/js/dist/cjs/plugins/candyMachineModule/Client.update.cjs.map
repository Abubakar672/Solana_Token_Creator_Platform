{"version":3,"file":"Client.update.cjs","sources":["../../../../src/plugins/candyMachineModule/Client.update.ts"],"sourcesContent":["import type { CandyMachineClient } from './CandyMachineClient';\nimport {\n  CandyMachineAlreadyHasThisAuthorityError,\n  CandyMachineToUpdateNotFoundError,\n  UpdatedCandyMachineNotFoundError,\n} from '@/errors';\nimport { CandyMachine } from './CandyMachine';\nimport {\n  UpdateCandyMachineInputWithoutCandyMachineData,\n  updateCandyMachineOperation,\n  UpdateCandyMachineOutput,\n} from './updateCandyMachine';\nimport { CandyMachineData } from '@metaplex-foundation/mpl-candy-machine';\nimport {\n  UpdateAuthorityInput,\n  updateAuthorityOperation,\n  UpdateAuthorityOutput,\n} from './updateAuthority';\n\nexport type UpdateCandyMachineParams =\n  UpdateCandyMachineInputWithoutCandyMachineData & Partial<CandyMachineData>;\n\nexport type UpdateCandyMachineAuthorityParams = UpdateAuthorityInput;\n\nexport async function update(\n  this: CandyMachineClient,\n  input: UpdateCandyMachineParams\n): Promise<UpdateCandyMachineOutput & { candyMachine: CandyMachine }> {\n  const currentCandyMachine = await this.findByAddress(\n    input.candyMachineAddress\n  );\n  if (currentCandyMachine == null) {\n    throw new CandyMachineToUpdateNotFoundError(input.candyMachineAddress);\n  }\n\n  const updatedData = currentCandyMachine.updatedCandyMachineData(input);\n\n  const operation = updateCandyMachineOperation({ ...input, ...updatedData });\n  const output = await this.metaplex.operations().execute(operation);\n\n  const candyMachine = await this.findByAddress(input.candyMachineAddress);\n  if (candyMachine == null) {\n    throw new UpdatedCandyMachineNotFoundError(input.candyMachineAddress);\n  }\n\n  return { candyMachine, ...output };\n}\n\nexport async function updateAuthority(\n  this: CandyMachineClient,\n  input: UpdateCandyMachineAuthorityParams\n): Promise<UpdateAuthorityOutput & { candyMachine: CandyMachine }> {\n  const currentCandyMachine = await this.findByAddress(\n    input.candyMachineAddress\n  );\n  if (currentCandyMachine == null) {\n    throw new CandyMachineToUpdateNotFoundError(input.candyMachineAddress);\n  }\n\n  if (currentCandyMachine.authorityAddress.equals(input.newAuthorityAddress)) {\n    throw new CandyMachineAlreadyHasThisAuthorityError(\n      input.newAuthorityAddress\n    );\n  }\n\n  const operation = updateAuthorityOperation(input);\n  const output = await this.metaplex.operations().execute(operation);\n\n  const candyMachine = await this.findByAddress(input.candyMachineAddress);\n  if (candyMachine == null) {\n    throw new UpdatedCandyMachineNotFoundError(input.candyMachineAddress);\n  }\n\n  return { candyMachine, ...output };\n}\n"],"names":["update","input","currentCandyMachine","findByAddress","candyMachineAddress","CandyMachineToUpdateNotFoundError","updatedData","updatedCandyMachineData","operation","updateCandyMachineOperation","output","metaplex","operations","execute","candyMachine","UpdatedCandyMachineNotFoundError","updateAuthority","authorityAddress","equals","newAuthorityAddress","CandyMachineAlreadyHasThisAuthorityError","updateAuthorityOperation"],"mappings":";;;;;;;;AAwBO,eAAeA,MAAf,CAELC,KAFK,EAG+D;EACpE,MAAMC,mBAAmB,GAAG,MAAM,IAAA,CAAKC,aAAL,CAChCF,KAAK,CAACG,mBAD0B,CAAlC,CAAA;;EAGA,IAAIF,mBAAmB,IAAI,IAA3B,EAAiC;AAC/B,IAAA,MAAM,IAAIG,mDAAJ,CAAsCJ,KAAK,CAACG,mBAA5C,CAAN,CAAA;AACD,GAAA;;AAED,EAAA,MAAME,WAAW,GAAGJ,mBAAmB,CAACK,uBAApB,CAA4CN,KAA5C,CAApB,CAAA;AAEA,EAAA,MAAMO,SAAS,GAAGC,8CAA2B,CAAC,EAAE,GAAGR,KAAL;IAAY,GAAGK,WAAAA;AAAf,GAAD,CAA7C,CAAA;EACA,MAAMI,MAAM,GAAG,MAAM,IAAKC,CAAAA,QAAL,CAAcC,UAAd,EAA2BC,CAAAA,OAA3B,CAAmCL,SAAnC,CAArB,CAAA;EAEA,MAAMM,YAAY,GAAG,MAAM,IAAA,CAAKX,aAAL,CAAmBF,KAAK,CAACG,mBAAzB,CAA3B,CAAA;;EACA,IAAIU,YAAY,IAAI,IAApB,EAA0B;AACxB,IAAA,MAAM,IAAIC,kDAAJ,CAAqCd,KAAK,CAACG,mBAA3C,CAAN,CAAA;AACD,GAAA;;EAED,OAAO;IAAEU,YAAF;IAAgB,GAAGJ,MAAAA;GAA1B,CAAA;AACD,CAAA;AAEM,eAAeM,eAAf,CAELf,KAFK,EAG4D;EACjE,MAAMC,mBAAmB,GAAG,MAAM,IAAA,CAAKC,aAAL,CAChCF,KAAK,CAACG,mBAD0B,CAAlC,CAAA;;EAGA,IAAIF,mBAAmB,IAAI,IAA3B,EAAiC;AAC/B,IAAA,MAAM,IAAIG,mDAAJ,CAAsCJ,KAAK,CAACG,mBAA5C,CAAN,CAAA;AACD,GAAA;;EAED,IAAIF,mBAAmB,CAACe,gBAApB,CAAqCC,MAArC,CAA4CjB,KAAK,CAACkB,mBAAlD,CAAJ,EAA4E;AAC1E,IAAA,MAAM,IAAIC,0DAAJ,CACJnB,KAAK,CAACkB,mBADF,CAAN,CAAA;AAGD,GAAA;;AAED,EAAA,MAAMX,SAAS,GAAGa,0CAAwB,CAACpB,KAAD,CAA1C,CAAA;EACA,MAAMS,MAAM,GAAG,MAAM,IAAKC,CAAAA,QAAL,CAAcC,UAAd,EAA2BC,CAAAA,OAA3B,CAAmCL,SAAnC,CAArB,CAAA;EAEA,MAAMM,YAAY,GAAG,MAAM,IAAA,CAAKX,aAAL,CAAmBF,KAAK,CAACG,mBAAzB,CAA3B,CAAA;;EACA,IAAIU,YAAY,IAAI,IAApB,EAA0B;AACxB,IAAA,MAAM,IAAIC,kDAAJ,CAAqCd,KAAK,CAACG,mBAA3C,CAAN,CAAA;AACD,GAAA;;EAED,OAAO;IAAEU,YAAF;IAAgB,GAAGJ,MAAAA;GAA1B,CAAA;AACD;;;;;"}