{"version":3,"file":"CandyMachine.cjs","sources":["../../../../src/plugins/candyMachineModule/CandyMachine.ts"],"sourcesContent":["import { PublicKey } from '@solana/web3.js';\nimport { bignum } from '@metaplex-foundation/beet';\nimport {\n  CandyMachineData,\n  ConfigLine,\n  Creator,\n  EndSettings,\n  GatekeeperConfig,\n  HiddenSettings,\n  WhitelistMintSettings,\n} from '@metaplex-foundation/mpl-candy-machine';\nimport { CandyMachineAccount } from '@/programs';\nimport { Model } from '@/types';\nimport {\n  getConfigLines,\n  getConfigLinesCount,\n} from '@/programs/candyMachine/accounts/candyMachineInternals';\n\nexport class CandyMachine extends Model {\n  // -----------------\n  // Data from CandyMachineAccount\n  // -----------------\n  readonly uuid: string;\n\n  readonly price: bignum;\n  readonly symbol: string;\n  readonly sellerFeeBasisPoints: number;\n\n  readonly maxSupply: bignum;\n  readonly isMutable: boolean;\n  readonly retainAuthority: boolean;\n  readonly goLiveDate?: bignum;\n  readonly itemsAvailable: bignum;\n\n  readonly endSettings?: EndSettings;\n  readonly hiddenSettings?: HiddenSettings;\n  readonly whitelistMintSettings?: WhitelistMintSettings;\n  readonly gatekeeper?: GatekeeperConfig;\n\n  readonly creators: Creator[];\n\n  readonly itemsRedeemed: bignum;\n\n  // -----------------\n  // Addresses from CandyMachineAccount\n  // -----------------\n  readonly authorityAddress: PublicKey;\n  readonly walletAddress: PublicKey;\n  readonly tokenMintAddress?: PublicKey;\n\n  /**\n   * Address at which the Candy Machine is stored on chain.\n   */\n  readonly candyMachineAddress: PublicKey;\n\n  private constructor(\n    readonly candyMachineAccount: CandyMachineAccount,\n    readonly rawData: Buffer\n  ) {\n    super();\n\n    // CandyMachine inner Data\n    const accountData = candyMachineAccount.data;\n    this.uuid = accountData.data.uuid;\n    this.price = accountData.data.price;\n    this.symbol = accountData.data.symbol;\n    this.sellerFeeBasisPoints = accountData.data.sellerFeeBasisPoints;\n\n    this.maxSupply = accountData.data.maxSupply;\n    this.isMutable = accountData.data.isMutable;\n    this.retainAuthority = accountData.data.retainAuthority;\n    this.goLiveDate = accountData.data.goLiveDate ?? undefined;\n    this.itemsAvailable = accountData.data.itemsAvailable;\n\n    this.endSettings = accountData.data.endSettings ?? undefined;\n    this.hiddenSettings = accountData.data.hiddenSettings ?? undefined;\n    this.whitelistMintSettings =\n      accountData.data.whitelistMintSettings ?? undefined;\n    this.gatekeeper = accountData.data.gatekeeper ?? undefined;\n\n    this.creators = accountData.data.creators;\n\n    // CandyMachine Data\n    this.itemsRedeemed = accountData.itemsRedeemed;\n\n    // CandyMachine Addresses\n    this.authorityAddress = accountData.authority;\n    this.walletAddress = accountData.wallet;\n    this.tokenMintAddress = accountData.tokenMint ?? undefined;\n    this.candyMachineAddress = candyMachineAccount.publicKey;\n  }\n\n  get assetsCount(): number {\n    return getConfigLinesCount(this.rawData);\n  }\n\n  get assets(): ConfigLine[] {\n    return getConfigLines(this.rawData);\n  }\n\n  get isFull(): boolean {\n    return this.assetsCount >= this.maxSupply;\n  }\n\n  get candyMachineData(): CandyMachineData {\n    return {\n      uuid: this.uuid,\n      price: this.price,\n      symbol: this.symbol,\n      sellerFeeBasisPoints: this.sellerFeeBasisPoints,\n      maxSupply: this.maxSupply,\n      isMutable: this.isMutable,\n      retainAuthority: this.retainAuthority,\n      goLiveDate: this.goLiveDate ?? null,\n      itemsAvailable: this.itemsAvailable,\n      endSettings: this.endSettings ?? null,\n      hiddenSettings: this.hiddenSettings ?? null,\n      whitelistMintSettings: this.whitelistMintSettings ?? null,\n      gatekeeper: this.gatekeeper ?? null,\n      creators: this.creators,\n    };\n  }\n\n  updatedCandyMachineData(\n    update: Partial<CandyMachineData> & Record<string, any>\n  ): CandyMachineData {\n    const candyUpdate = Object.entries(update).reduce((acc, [key, value]) => {\n      if (this.candyMachineData.hasOwnProperty(key)) {\n        acc[key as keyof CandyMachineData] = value;\n      }\n      return acc;\n    }, {} as Partial<CandyMachineData>);\n    return { ...this.candyMachineData, ...candyUpdate };\n  }\n\n  static fromAccount(\n    candyMachineAccount: CandyMachineAccount,\n    rawData: Buffer\n  ): CandyMachine {\n    return new CandyMachine(candyMachineAccount, rawData);\n  }\n}\n"],"names":["CandyMachine","Model","constructor","candyMachineAccount","rawData","accountData","data","uuid","price","symbol","sellerFeeBasisPoints","maxSupply","isMutable","retainAuthority","goLiveDate","undefined","itemsAvailable","endSettings","hiddenSettings","whitelistMintSettings","gatekeeper","creators","itemsRedeemed","authorityAddress","authority","walletAddress","wallet","tokenMintAddress","tokenMint","candyMachineAddress","publicKey","assetsCount","getConfigLinesCount","assets","getConfigLines","isFull","candyMachineData","updatedCandyMachineData","update","candyUpdate","Object","entries","reduce","acc","key","value","hasOwnProperty","fromAccount"],"mappings":"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"}