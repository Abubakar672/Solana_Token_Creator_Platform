{"version":3,"file":"findNftsByCandyMachine.cjs","sources":["../../../../src/plugins/nftModule/findNftsByCandyMachine.ts"],"sourcesContent":["import { PublicKey } from '@solana/web3.js';\nimport { Metaplex } from '@/Metaplex';\nimport { Operation, OperationHandler, useOperation } from '@/types';\nimport { findNftsByCreatorOperation } from './findNftsByCreator';\nimport { Nft } from './Nft';\n\nconst Key = 'FindNftsByCandyMachineOperation' as const;\nexport const findNftsByCandyMachineOperation =\n  useOperation<FindNftsByCandyMachineOperation>(Key);\nexport type FindNftsByCandyMachineOperation = Operation<\n  typeof Key,\n  FindNftsByCandyMachineInput,\n  Nft[]\n>;\n\nexport interface FindNftsByCandyMachineInput {\n  candyMachine: PublicKey;\n  version?: 1 | 2;\n}\n\nexport const findNftsByCandyMachineOnChainOperationHandler: OperationHandler<FindNftsByCandyMachineOperation> =\n  {\n    handle: async (\n      operation: FindNftsByCandyMachineOperation,\n      metaplex: Metaplex\n    ): Promise<Nft[]> => {\n      const { candyMachine, version = 2 } = operation.input;\n      let firstCreator = candyMachine;\n\n      if (version === 2) {\n        // TODO: Refactor when we have a CandyMachine program in the SDK.\n        [firstCreator] = PublicKey.findProgramAddressSync(\n          [Buffer.from('candy_machine'), candyMachine.toBuffer()],\n          new PublicKey('cndy3Z4yapfJBmL3ShUp5exZKqR3z33thTzeNMm2gRZ')\n        );\n      }\n\n      return metaplex.operations().execute(\n        findNftsByCreatorOperation({\n          creator: firstCreator,\n          position: 1,\n        })\n      );\n    },\n  };\n"],"names":["Key","findNftsByCandyMachineOperation","useOperation","findNftsByCandyMachineOnChainOperationHandler","handle","operation","metaplex","candyMachine","version","input","firstCreator","PublicKey","findProgramAddressSync","Buffer","from","toBuffer","operations","execute","findNftsByCreatorOperation","creator","position"],"mappings":";;;;;;;;AAMA,MAAMA,GAAG,GAAG,iCAAZ,CAAA;MACaC,+BAA+B,GAC1CC,sBAAY,CAAkCF,GAAlC,EADP;AAaA,MAAMG,6CAAgG,GAC3G;AACEC,EAAAA,MAAM,EAAE,OACNC,SADM,EAENC,QAFM,KAGa;IACnB,MAAM;MAAEC,YAAF;AAAgBC,MAAAA,OAAO,GAAG,CAAA;KAAMH,GAAAA,SAAS,CAACI,KAAhD,CAAA;IACA,IAAIC,YAAY,GAAGH,YAAnB,CAAA;;IAEA,IAAIC,OAAO,KAAK,CAAhB,EAAmB;AACjB;MACA,CAACE,YAAD,CAAiBC,GAAAA,iBAAS,CAACC,sBAAV,CACf,CAACC,MAAM,CAACC,IAAP,CAAY,eAAZ,CAAD,EAA+BP,YAAY,CAACQ,QAAb,EAA/B,CADe,EAEf,IAAIJ,iBAAJ,CAAc,6CAAd,CAFe,CAAjB,CAAA;AAID,KAAA;;AAED,IAAA,OAAOL,QAAQ,CAACU,UAAT,GAAsBC,OAAtB,CACLC,4CAA0B,CAAC;AACzBC,MAAAA,OAAO,EAAET,YADgB;AAEzBU,MAAAA,QAAQ,EAAE,CAAA;AAFe,KAAD,CADrB,CAAP,CAAA;AAMD,GAAA;AAtBH;;;;;"}