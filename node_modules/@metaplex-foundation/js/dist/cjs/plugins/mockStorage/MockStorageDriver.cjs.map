{"version":3,"file":"MockStorageDriver.cjs","sources":["../../../../src/plugins/mockStorage/MockStorageDriver.ts"],"sourcesContent":["import BN from 'bn.js';\nimport { Amount, lamports } from '@/types';\nimport { AssetNotFoundError } from '@/errors';\nimport { MetaplexFile, StorageDriver } from '../storageModule';\n\nconst DEFAULT_BASE_URL = 'https://mockstorage.example.com/';\nconst DEFAULT_COST_PER_BYTE = new BN(1);\n\nexport type MockStorageOptions = {\n  baseUrl?: string;\n  costPerByte?: BN | number;\n};\n\nexport class MockStorageDriver implements StorageDriver {\n  private cache: Record<string, MetaplexFile> = {};\n  public readonly baseUrl: string;\n  public readonly costPerByte: BN;\n\n  constructor(options?: MockStorageOptions) {\n    this.baseUrl = options?.baseUrl ?? DEFAULT_BASE_URL;\n    this.costPerByte =\n      options?.costPerByte != null\n        ? new BN(options?.costPerByte)\n        : DEFAULT_COST_PER_BYTE;\n  }\n\n  async getUploadPrice(bytes: number): Promise<Amount> {\n    return lamports(this.costPerByte.muln(bytes));\n  }\n\n  async upload(file: MetaplexFile): Promise<string> {\n    const uri = `${this.baseUrl}${file.uniqueName}`;\n    this.cache[uri] = file;\n\n    return uri;\n  }\n\n  async download(uri: string): Promise<MetaplexFile> {\n    const file = this.cache[uri];\n\n    if (!file) {\n      throw new AssetNotFoundError(uri);\n    }\n\n    return file;\n  }\n}\n"],"names":["DEFAULT_BASE_URL","DEFAULT_COST_PER_BYTE","BN","MockStorageDriver","constructor","options","_defineProperty","baseUrl","costPerByte","getUploadPrice","bytes","lamports","muln","upload","file","uri","uniqueName","cache","download","AssetNotFoundError"],"mappings":";;;;;;;;;;;;;AAKA,MAAMA,gBAAgB,GAAG,kCAAzB,CAAA;AACA,MAAMC,qBAAqB,GAAG,IAAIC,sBAAJ,CAAO,CAAP,CAA9B,CAAA;AAOO,MAAMC,iBAAN,CAAiD;EAKtDC,WAAW,CAACC,OAAD,EAA+B;AAAA,IAAA,IAAA,gBAAA,CAAA;;AAAA,IAAAC,wCAAA,CAAA,IAAA,EAAA,OAAA,EAJI,EAIJ,CAAA,CAAA;;IACxC,IAAKC,CAAAA,OAAL,GAAeF,CAAAA,gBAAAA,GAAAA,OAAf,KAAeA,IAAAA,IAAAA,OAAf,uBAAeA,OAAO,CAAEE,OAAxB,MAAA,IAAA,IAAA,gBAAA,KAAA,KAAA,CAAA,GAAA,gBAAA,GAAmCP,gBAAnC,CAAA;IACA,IAAKQ,CAAAA,WAAL,GACE,CAAAH,OAAO,KAAA,IAAP,IAAAA,OAAO,KAAP,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,OAAO,CAAEG,WAAT,KAAwB,IAAxB,GACI,IAAIN,sBAAJ,CAAOG,OAAP,KAAOA,IAAAA,IAAAA,OAAP,KAAOA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,OAAO,CAAEG,WAAhB,CADJ,GAEIP,qBAHN,CAAA;AAID,GAAA;;EAEmB,MAAdQ,cAAc,CAACC,KAAD,EAAiC;IACnD,OAAOC,eAAQ,CAAC,IAAKH,CAAAA,WAAL,CAAiBI,IAAjB,CAAsBF,KAAtB,CAAD,CAAf,CAAA;AACD,GAAA;;EAEW,MAANG,MAAM,CAACC,IAAD,EAAsC;IAChD,MAAMC,GAAG,GAAI,CAAE,EAAA,IAAA,CAAKR,OAAQ,CAAEO,EAAAA,IAAI,CAACE,UAAW,CAA9C,CAAA,CAAA;AACA,IAAA,IAAA,CAAKC,KAAL,CAAWF,GAAX,CAAA,GAAkBD,IAAlB,CAAA;AAEA,IAAA,OAAOC,GAAP,CAAA;AACD,GAAA;;EAEa,MAARG,QAAQ,CAACH,GAAD,EAAqC;AACjD,IAAA,MAAMD,IAAI,GAAG,IAAA,CAAKG,KAAL,CAAWF,GAAX,CAAb,CAAA;;IAEA,IAAI,CAACD,IAAL,EAAW;AACT,MAAA,MAAM,IAAIK,2BAAJ,CAAuBJ,GAAvB,CAAN,CAAA;AACD,KAAA;;AAED,IAAA,OAAOD,IAAP,CAAA;AACD,GAAA;;AAhCqD;;;;"}